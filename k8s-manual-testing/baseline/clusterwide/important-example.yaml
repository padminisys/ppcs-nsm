apiVersion: cilium.io/v2
kind: CiliumNetworkPolicy
metadata:
  name: demo-all-in-one-egress-ingress
  namespace: tenant-ns-demo
spec:
  # Target all pods in this tenant namespace
  endpointSelector: {}

  # =========================
  # INGRESS — ALLOW examples
  # =========================
  ingress:
  # 1) Allow from ONE IP to ALL ports
  - fromCIDR:
    - "203.0.113.10/32"

  # 2) Allow from MULTIPLE IPs to a SPECIFIC PORT (TCP/443)
  - fromCIDR:
    - "198.51.100.77/32"
    - "198.51.100.88/32"
    toPorts:
    - ports:
      - port: "443"
        protocol: TCP

  # 3) Allow from ANY IP to a PORT RANGE (TCP/10000–10100)
  - fromCIDR:
    - "0.0.0.0/0"
    toPorts:
    - ports:
      - port: "10000"
        endPort: 10100
        protocol: TCP

  # =======================
  # INGRESS — DENY examples
  # =======================
  ingressDeny:
  # 4) Deny from ONE IP on ALL ports
  - fromCIDR:
    - "203.0.113.200/32"

  # 5) Deny from MULTIPLE IPs on a SPECIFIC PORT (UDP/123)
  - fromCIDR:
    - "192.0.2.10/32"
    - "192.0.2.11/32"
    toPorts:
    - ports:
      - port: "123"
        protocol: UDP

  # 6) Deny from ANY IP on a PORT RANGE (UDP/30000–32767)
  - fromCIDR:
    - "0.0.0.0/0"
    toPorts:
    - ports:
      - port: "30000"
        endPort: 32767
        protocol: UDP

  # ========================
  # EGRESS — ALLOW examples
  # ========================
  egress:
  # 7) Allow to ONE IP on ALL ports
  - toCIDR:
    - "203.0.113.20/32"

  # 8) Allow to MULTIPLE IPs on a SPECIFIC PORT (TCP/5432)
  - toCIDR:
    - "198.51.100.40/32"
    - "198.51.100.41/32"
    toPorts:
    - ports:
      - port: "5432"
        protocol: TCP

  # 9) Allow to ANY IP on a PORT RANGE (TCP/2000–2999)
  - toCIDR:
    - "0.0.0.0/0"
    toPorts:
    - ports:
      - port: "2000"
        endPort: 2999
        protocol: TCP

  # =======================
  # EGRESS — DENY examples
  # =======================
  egressDeny:
  # 10) Deny to ONE IP on ALL ports
  - toCIDR:
    - "203.0.113.30/32"

  # 11) Deny to MULTIPLE IPs on a SPECIFIC PORT (UDP/514)
  - toCIDR:
    - "198.51.100.60/32"
    - "198.51.100.61/32"
    toPorts:
    - ports:
      - port: "514"
        protocol: UDP

  # 12) Deny to ANY IP on a PORT RANGE (UDP/40000–40999)
  - toCIDR:
    - "0.0.0.0/0"
    toPorts:
    - ports:
      - port: "40000"
        endPort: 40999
        protocol: UDP
